---
import NavAvatar from './NavAvatar.astro'
import SocialLinks from './SocialLinks.astro'

const navItems = [
  { href: '/', text: 'Home' },
  { href: '/blog', text: 'Blog' },
  { href: '/projects', text: 'Projects' },
  { href: '/readme', text: 'Readme.md' },
]

const currentPath = Astro.url.pathname
---

<nav class='h-52 relative' aria-label='Main navigation'>
  <!-- Inverted mountain background -->
  <div
    class='absolute inset-0 bg-no-repeat bg-bottom bg-cover'
    style="background-image: url('/mountains-nav.svg')"
    aria-hidden='true'
  >
  </div>

  <!-- Navigation content -->
  <div class='relative z-10 flex flex-col h-full px-12'>
    <!-- Top navigation links -->
    <div class='flex justify-end pt-7' role="complementary" aria-label="Social links">
      <SocialLinks />
    </div>

    <!-- Brand section with navigation -->
    <div class='flex items-center space-x-8 mt-8'>
      <a 
        href='/' 
        class='block focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 rounded-full' 
        aria-label='Home page'
      >
        <NavAvatar />
      </a>
      <div class="flex items-baseline space-x-16">
        <h1
          class="text-3xl md:text-5xl lg:text-6xl font-['Abril_Fatface'] text-purple-50 opacity-80 tracking-normal hover:opacity-90 transition-opacity duration-300 text-shadow"
          id='site-title'
        >
          <span class='tracking-normal'>Juha</span>{' '}
          <span class='tracking-normal'>Halmu</span>
        </h1>
        
        <div 
          class="flex space-x-10" 
          role="menubar" 
          aria-label="Main menu"
        >
          {
            navItems.map((item) => {
              const isActive =
                currentPath === item.href ||
                (item.href !== '/' && currentPath.startsWith(item.href))
              return (
                <a
                  href={item.href}
                  class={`text-lg text-purple-50 opacity-80 hover:opacity-100 transition-opacity duration-300 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 rounded-md px-2 py-1 ${
                    isActive ? 'font-bold underline' : ''
                  }`}
                  role="menuitem"
                  aria-current={isActive ? 'page' : undefined}
                >
                  {item.text}
                </a>
              )
            })
          }
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  // Add keyboard navigation
  const menuItems = document.querySelectorAll<HTMLAnchorElement>('[role="menuitem"]')
  const menuItemsArray = Array.from(menuItems)

  menuItemsArray.forEach((item, index) => {
    item.addEventListener('keydown', (e) => {
      let targetItem: HTMLAnchorElement | undefined

      switch (e.key) {
        case 'ArrowRight':
        case 'ArrowDown':
          e.preventDefault()
          targetItem = menuItemsArray[index + 1] || menuItemsArray[0]
          break
        case 'ArrowLeft':
        case 'ArrowUp':
          e.preventDefault()
          targetItem = menuItemsArray[index - 1] || menuItemsArray[menuItemsArray.length - 1]
          break
        case 'Home':
          e.preventDefault()
          targetItem = menuItemsArray[0]
          break
        case 'End':
          e.preventDefault()
          targetItem = menuItemsArray[menuItemsArray.length - 1]
          break
      }

      targetItem?.focus()
    })
  })
</script>
